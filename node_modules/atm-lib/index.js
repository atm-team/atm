var fs = require('fs-extra');
module.exports = {
    /**
     *
     * @param filePath json文件路径
     * @param defaultData 如果文件不存在时,指定默认值; 若不指定且json文件不存在时,返回{}
     * @returns {*} 返回读取到的json或指定的默认值
     */
    getJson: function (filePath, defaultData) {
        defaultData = (typeof defaultData === 'undefined') ? {} : defaultData;
        if (fs.existsSync(filePath)) {
            try {
                return fs.readJsonSync(filePath);
            } catch (err) {
                return defaultData;
            }
        } else {
            return defaultData;
        }
    },

    /**
     * 判断文件是否存在
     * @param filePath
     * @returns {*}
     */
    exists: function (filePath) {
        return fs.existsSync(filePath);
    },

    /**
     * 替换字符串里面的占位符
     * @param str
     * @param obj
     * @returns {*}
     */
    replacePlaceholder: function (str, obj) {
        obj = obj || {};
        if (obj.homedir) {
            str = str.replace(/\{\{\s*homedir\s*\}\}/img, obj.homedir);
        }
        if (obj.sitedir) {
            str = str.replace(/\{\{\s*sitedir\s*\}\}/img, obj.sitedir);
        }
        if (obj.site) {
            str = str.replace(/\{\{\s*site\s*\}\}/img, obj.site);
        }
        if (obj.project) {
            str = str.replace(/\{\{\s*project\s*\}\}/img, obj.project);
        }
        if (obj.module) {
            str = str.replace(/\{\{\s*module\s*\}\}/img, obj.module);
        }
        if (obj.version) {
            str = str.replace(/\{\{\s*version\s*\}\}/img, obj.version);
        }
        if (obj.router) {
            str = str.replace(/\{\{\s*router\s*\}\}/img, obj.router);
        }
        if (obj.target) {
            str = str.replace(/\{\{\s*target\s*\}\}/img, obj.target);
        }
        if (obj.domain) {
            str = str.replace(/\{\{\s*domain\s*\}\}/img, obj.domain);
        }
        if (obj.offset) {
            str = str.replace(/\{\{\s*offset\s*\}\}/img, obj.offset);
        }
        return str;
    },

    /**
     * require最新的js模块
     * @param filePath
     * @returns {*|Object}
     */
    requireLatest: function (filePath) {
        delete require.cache[require.resolve(filePath)];
        return require(filePath);
    }

}
